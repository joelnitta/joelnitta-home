---
title: "Publications"
date: "`r Sys.Date()`"
output: distill::distill_article
editor_options: 
  chunk_output_type: console
execute:
  echo: false
---

```{r}
#| label: setup
#| include: false
library(distilltools)
library(RefManageR)
library(bib2df)
library(bibtex)
library(janitor)
library(lubridate)
library(glue)
library(tidyverse)
```

```{r}
#| label: setup-refs
#| message: false
#| warning: false

# Load bibliography
bib_path <- "_bib/references.bib"
# - as list
mybib <- ReadBib(bib_path, check = FALSE) 
# - as dataframe
mybib_df_raw <- 
  suppressWarnings(
    suppressMessages(
      bib2df(bib_path)
    )
  )
# Load other metadata
mybib_meta <- read_csv("_bib/ref_metadata.csv") %>% select(-title)

# Format dataframe version of bibliography
mybib_df <-
	mybib_df_raw %>%
	clean_names() %>%
	select(key = bibtexkey, date, doi, title, author, journaltitle) %>%
	mutate(
		date = parse_date_time(date, "ymd"),
		year = year(date)) %>%
	arrange(desc(year), key) %>%
	# add other metadata (github repo, dryad link, prprint, etc)
	left_join(mybib_meta, by = "key")

# Set RefManageR options
oldopts <- BibOptions(
	style = "text",
	bib.style = "authoryear", 
	no.print.fields = c("doi", "url", "urldate", "eprint", "eprinttype"),
	max.names = 50,
	dashed = FALSE, 
	sorting = "ydnt")
```

```{r}
#| label: cite-func

# Define functions for formatting a citation

#' Make a link button
#'
#' @param key_select Bibtex key
#' @param link_type Type of link ("github", "biorxiv", "figshare", "dryad", "pdf")
#' Should be one of column names in bibliography metadata
#' @param text Text to include next to to icon.
#' @param bib_df Bibliography data (`mybib_df`)
#'
#' @return HTML to make a link button
link_button <- function(key_select, link_type, text, bib_df = mybib_df) {
	url <- filter(bib_df, key == key_select)[[link_type]]
	if (is.na(url)) return(NULL)
	icon_link(icon = link_type, text = text, url = url)
}

#' Make a DOI link
#'
#' @param key_select Bibtex key
#' @param bib_df Bibliography data as dataframe
#'
#' @return HTML with link to DOI corresponding to citation specified with key
doi_link <- function(key_select, bib_df = mybib_df) {
	doi <- filter(bib_df, key == key_select) %>% pull(doi)
	if (is.na(doi)) return(NULL)
	glue("DOI: [{doi}](https://doi.org/{doi})")
}

#' Print a simple reference
#'
#' @param key_select Bibtex key
#' @param bib Bibtex bibliography read in with RefManageR::ReadBib()
#'
#' @return Text of reference
print_ref_simple <- function(key_select, bib = mybib) {
	# Silently cite the key
	NoCite(bib, key_select)
	# Capture the output of printing the reference
	capture.output(foo <- print(bib[[key_select]])) %>%
		paste(collapse = " ") %>%
		# Make my name in bold
		str_replace_all("Nitta, J. H.", "__Nitta, J. H.__") %>%
		str_replace_all("J. H. Nitta", "__J. H. Nitta__")
}

#' Print a reference with link buttons
#'
#' @param key_select Bibtex key
#' @param bib Bibtex bibliography read in with RefManageR::ReadBib()
#' @param bib_df Bibliography data as dataframe, including metadata
#' (links to github, biorxiv, dryad, etc)
#'
#' @return Text of reference, with HTML buttons to links below it
print_ref <- function(key_select, bib = mybib, bib_df = mybib_df) {
	ref <- print_ref_simple(key_select = key_select, bib = bib)
	doi <- doi_link(key_select, bib_df = bib_df)
	biorxiv <- link_button(key_select, "biorxiv", "Preprint", bib_df)
	github <- link_button(key_select, "github", "Code", bib_df)
	dryad <- link_button(key_select, "dryad", "Data", bib_df)
	figshare <- link_button(key_select, "figshare", "Data", bib_df)
	pdf <- link_button(key_select, "file-pdf", "PDF", bib_df)
	
	main_ref <- paste(ref, doi, sep = " ")
	buttons <- paste(biorxiv, github, dryad, figshare, pdf)
	paste(main_ref, buttons, sep = "<br>")
}
```

`r icon_link("google-scholar", "Google Scholar", "https://scholar.google.com/citations?hl=en&user=FtzrMYwAAAAJ")`  

## Forthcoming

**Nitta, J. H.**, E. Schuettpelz, S. Ram√≠rez-Barahona, and W. Iwasaki. "An open and continuously updated Fern Tree of Life (FTOL)". Submitted.

`r icon_link(text = "Preprint", url = "https://doi.org/10.1101/2022.03.31.486640")`
`r icon_link(icon = "github", text = "Code", url = "https://github.com/fernphy/ftol")`

**Nitta, J. H.**, B. D. Mishler, W. Iwasaki, and A. Ebihara. "Spatial phylogenetics of Japanese ferns: Patterns, processes, and implications for conservation". In: *American Journal of Botany*. Accepted.

`r icon_link(text = "Preprint", url = "https://doi.org/10.1101/2021.08.26.457744")`
`r icon_link(icon = "github", text = "Code", url = "https://github.com/joelnitta/japan_ferns_spatial_phy")`

**Nitta, J. H.** and S. M. Chambers. "Identifying cryptic fern gametophytes using DNA barcoding: A review". In: *Applications in Plant Sciences*. Accepted.

`r icon_link(text = "Preprint", url = "https://ecoevorxiv.org/dr25p/")`
`r icon_link(icon = "github", text = "Code", url = "https://github.com/joelnitta/gameto-barcode-review")`

## 2021

`r print_ref("Nitta2021")`

<aside>
```{r}
#| label: Nitta2021-cover
#| echo: false
knitr::include_graphics("content/images/jpr_cover.jpg")
```
</aside>

## 2020

`r print_ref("Nitta2020")`

`r print_ref("Nitta2020c")`

## 2019

`r print_ref("Ebihara2019a")`

`r print_ref("Ebihara2019b")`

`r print_ref("Nitta2019")`

## 2018

`r print_ref("Gilbert2018")`

`r print_ref("Nitta2018")`

## 2017

`r print_ref("Nitta2017")`

`r print_ref("Pinson2016a")`

`r print_ref("Zhou2017")`

## 2016

`r print_ref("Pouteau2016")`

## 2015

`r print_ref("Chen2015")`

## 2013

`r print_ref("Ebihara2013")`

## 2011

`r print_ref("Nitta2011")`

<aside>
```{r}
#| label: nitta2011-cover
#| echo: false

knitr::include_graphics("content/images/ajb_cover.jpg")
```
</aside>

`r print_ref("Nitta2011b")`

## 2010

`r print_ref("Ebihara2010")`

## 2009

`r print_ref("Ebihara2009b")`

`r print_ref("Nitta2009")`

## 2008

`r print_ref("Nitta2008")`

`r print_ref("Nitta2008a")`
