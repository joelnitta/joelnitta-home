---
title: "Managing bioinformatics pipelines with R (Part 2)"
description:
  An update on managing bioinformatics pipelines with R, mainly to highlight a
  nifty new function that allows you to (more) easily run Docker containers.
author:
  - first_name: "Joel"
    last_name: "Nitta"
    url: https://joelnitta.com
    affiliation: University of Tokyo
    affiliation_url: http://iwasakilab.k.u-tokyo.ac.jp
    orcid_id: 0000-0003-4719-7472
date: 2022-01-13
preview: img/bart-van-meele-ns4bIZ6XeGY-unsplash.jpg
creative_commons: CC BY
citation_url: https://joelnitta.com/r-bioinfo-pt2 
repository_url: https://github.com/joelnitta/joelnitta-home
output:
  distill::distill_article:
    self_contained: false
params:
  slug: r-bioinfo-pt2
  date: 2022-01-13
  repo: joelnitta/joelnitta-home
  site: https://joelnitta.com
editor_options: 
  chunk_output_type: console
draft: true
---

<!----
checklist:
  - check the "update me" messages in YAML above
  - initialise the _renv folder with refinery::renv_new("name of post folder")
  - populate the lockfile with refinery::renv_snapshot("name of post folder")
  - update the _renv folder from snapshot with refinery::restore("name of post folder")
---->


<!--------------- setup post ----------------->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
refinery::renv_load(paste(params$date, params$slug, sep = "_"))
```

```{r xaringanExtra-clipboard, echo=FALSE}
# Enable copy-paste of code chunks
# xaringanExtra::use_clipboard()
htmltools::tagList(
  xaringanExtra::use_clipboard(
    button_text = "<i class=\"fa fa-clipboard fa-2x\"></i>",
    success_text = "<i class=\"fa fa-check fa-2x\" style=\"color: #90BE6D\"></i>",
    error_text = "<i class=\"fa fa-times-circle fa-2x\" style=\"color: #F94144\"></i>"
  ),
  rmarkdown::html_dependency_font_awesome()
)
```

<!--------------- post ----------------->

As I previous blogged about, R is a great tool for managing bioinformatics workflows. At least, I think it has that potential, but it isn't used for this purpose very widely yet. I recently figured out a trick that makes it easier to use, which I describe below.

If you haven't read my first blogpost on this topic, I recommend reading that first to get up to speed.

## Docker and babelwhale

As mentioned previously mentioned, we can call Docker from R using the [babelwhale](https://github.com/dynverse/babelwhale) package, in particular the [`run()` function](https://www.rdocumentation.org/packages/babelwhale/versions/1.0.3/topics/run).

`babelwhale::run()` can be thought of as a thin wrapper around `docker run`. Here is a plain text view of how they compare:

```
docker run [OPTIONS] IMAGE [COMMAND] [ARG...]
              |       |         |        |  
              |       |         |        |                
              \-------|---------|--------|--------\  
                      |         |        |        |
                      |         |        |        |
babelwhale::run(container_id, command, args, volumes)
```

## Volume headaches

Until recently, my typical workflow has been to write a wrapper function for each docker command that I can execute from R using `babelwhale::run()`. However, I quickly noticed that the process of specifying volumes for files was tedious and repetitive. Each time I had to think about the paths to use for the files inside the container, and how they should relate to the paths outside the container. Wouldn't it be great if we could abstract this away and just automatically mount files?

As it turns out, we can! I realized that docker is pretty open-minded when it comes to volume mounts. For example, it's no problem to have multiple volumes mounted to one container, and the paths inside the container can be arbitrary as long as they don't clobber any existing folders---Docker will create them for us as needed.

<!--------------- appendices ----------------->

```{r, echo=FALSE}
refinery::insert_appendix(
  repo_spec = params$repo, 
  name = paste(params$date, params$slug, sep = "_"),
  source_branch = "main", lockfile_branch = "main"
)
```


<!--------------- miscellanea ----------------->

```{r redirect, echo=FALSE}
refinery::insert_netlify_redirect(
  slug = params$slug, 
  date = params$date
)
```
