---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file and render with rmarkdown::render("README.Rmd")-->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# joelnitta-home

Source code for [personal website of Joel Nitta](https://www.joelnitta.com).

Created with [Quarto](https://quarto.org/) in [R](https://www.r-project.org/).


## Production deployment

Production deployment is set up using GitHub Actions with [./.github/workflows/publish-cloudflare-pages.yml](./.github/workflows/publish-cloudflare-pages.yml).

The workflow file is very simple and basically runs two commands:

1. `Rscript -e 'babelquarto::render_website()'`, which compiles the Quarto blog to a static website within the `_site` folder. This folder contains an `index.html` which is the root of the website, as well as various JavaScript and CSS files and images; you can read more on [`quarto render`](https://quarto.org/docs/projects/quarto-projects.html#rendering-projects). Note that `_site` is ignored in `.gitignore` because it is generated from the source code; the source code is what we track in version control, not the built files.

2. `wrangler pages deploy _site --project-name=joelnitta-home`, which deploys the `_site` folder to Cloudflare Pages. You can read more details on [`wrangler pages deploy`](https://developers.cloudflare.com/workers/wrangler/commands/#deploy-1).

### Secrets

This workflow requires two secrets to be set up in GitHub:

- `CLOUDFLARE_API_TOKEN`: see Cloudflare docs on [how to create an API token](https://developers.cloudflare.com/pages/how-to/use-direct-upload-with-continuous-integration/#generate-an-api-token)
- `CLOUDFLARE_ACCOUNT_ID`: see Cloudflare docs on [how to get the account ID](https://developers.cloudflare.com/pages/how-to/use-direct-upload-with-continuous-integration/#get-project-account-id)

Both secrets must be stored in the settings for the GitHub repository - see GitHub docs on [Creating secrets for a repository](https://docs.github.com/en/actions/security-for-github-actions/security-guides/using-secrets-in-github-actions#creating-secrets-for-a-repository).


## Local deployment

- Generate the translated website with `babelquarto::render_website()`

- Preview the website with `servr::httw("_site")`

## Drafting a new blogpost

Use the [custom `draft_post()` function](R/functions.R):

```{r}
post_qmd <- draft_post(
  slug = "example_post",
  title = "How to use the draft_post() function",
  desc = "Using templates to increase productivity",
  categories = c("R", "data")
)
readr::read_lines(post_qmd)
fs::dir_delete(fs::path_dir(post_qmd))
```

## Licenses

Code: [MIT](LICENSE)

Text and images, unless otherwise indicated: Creative Commons Attribution [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/legalcode)

Publications (PDF files): Indicated in each publication.
