{
  "hash": "e57295089af2f8c78bd5d92902734ffd",
  "result": {
    "markdown": "---\ntitle: \"canaper is on CRAN\"\ndescription: Announcing the canaper R package!\nbibliography: references.yaml\ndate: 2022-10-07\ndate-modified: today\nimage: https://docs.ropensci.org/canaper/logo.png\ncitation:\n  url: https://www.joelnitta.com/posts/canaper/\ncategories:\n  - R\n  - Spatial phylogenetics\nknitr:\n  opts_chunk: \n      cache: true\nlang: en\n---\n\n\n## Introducing `canaper`\n\n\n\n\n\n(Read this blogpost in [Japanese](https://www.ja.joelnitta.com/posts/2022-10-07_canaper/))\n\nI am happy to announce that [`canaper`](https://github.com/ropensci/canaper) v1.0.0 is now available on [CRAN](https://cran.r-project.org/web/packages/canaper/index.html)!\nAlthough I have authored [several R packages](https://www.joelnitta.com/software.html) and made them available via [GitHub](https://github.com/joelnitta/#r-packages-), this is my first original package to be on CRAN.\n\nWhat is `canaper` you ask?\n\n> `canaper` provides functions to analyze the spatial distribution of\nbiodiversity, in particular categorical analysis of neo- and paleo-endemism\n(CANAPE) as described in Mishler et al (2014) [doi:10.1038/ncomms5473](https://doi.org/10.1038/ncomms5473).\n`canaper` conducts statistical tests to determine the types of endemism that\noccur in a study area while accounting for the evolutionary relationships of\nspecies.\n\n(from the package [DESCRIPTION](https://github.com/ropensci/canaper/blob/main/DESCRIPTION)).\n\nIf that interests you, please read on!\n\n## Phylogenetic endemism and CANAPE\n\n[Biodiversity](https://en.wikipedia.org/wiki/Biodiversity) is often measured by [species richness](https://en.wikipedia.org/wiki/Species_richness), or counting the number of species in an area.\nLikewise, [endemism](https://en.wikipedia.org/wiki/Endemism) is often quantified by the number of species that are completely restricted (endemic) to an area.\nHowever, such purely taxonomic approaches ignore evolutionary history.\nThanks to the widespread availability of molecular [phylogenies](https://en.wikipedia.org/wiki/Phylogenetic_tree), approaches have recently been developed that quantify biodiversity while taking into account the evolutionary history of species.\nOne such method is **phylogenetic endemism** [PE\\; @Rosauer2009], which quantifies endemism based on the range size of **branches of a phylogenetic tree** instead of species.\n\nAn advantage of PE is that it provides insight into the **evolutionary processes generating biodiversity**.\nFor example, areas with high PE and many short branches may be due to recent speciation (radiation) and are termed **neo-endemic**.\nIn contrast, areas with high PE and many long branches may be due to extinction of previously widespread lineages and are termed **paleo-endemic**.\nA method to detect these areas developed by @Mishler2014 is called CANAPE (\"**C**ategorical **A**nalysis of **N**eo- and **P**aleo-**E**ndemism\").\n\nThe goal of `canaper` is to conduct CANAPE in R.\n\n## Example: Australian *Acacia*\n\n![*Acacia pycnantha*, photo by [Bidgee](https://commons.wikimedia.org/wiki/User:Bidgee)](Golden-wattle.jpg)\n\n`canaper` comes with the same dataset that was analyzed in the original CANAPE paper, a community (species $\\times$ sites) matrix and phylogenetic tree of Australian *Acacia*^[*Acacia* is the largest genus of flowering plants in Australia, with nearly 1,000 species] [@Mishler2014].\nWe will use this for a quick demo^[The settings used here are for demonstration purposes only, and not suitable for a thorough analysis of this dataset].\n\nI won't go into the details here, but you can [read more about this example](https://docs.ropensci.org/canaper/articles/canape.html) on the [`canaper` website](https://docs.ropensci.org/canaper/index.html).\n\nThe entire CANAPE workflow can be run with just two commands, [`cpr_rand_test()`](https://docs.ropensci.org/canaper/reference/cpr_rand_test.html) and [`cpr_classify_endem()`](https://docs.ropensci.org/canaper/reference/cpr_classify_endem.html):\n\n\n::: {.cell hash='index_cache/html/acacia-demo_4421c510d05382d04119d9b829ec0b21'}\n\n```{.r .cell-code}\nlibrary(canaper)\nlibrary(tidyverse)\n\n# Set a seed for reproducibility\nset.seed(12345)\n\n# 1. Run randomization test\nacacia_rand_res <- cpr_rand_test(\n  acacia$comm, acacia$phy,\n  null_model = \"curveball\",\n  n_reps = 99, n_iterations = 10000,\n  tbl_out = TRUE\n)\n\n# 2. Classify endemism\nacacia_canape <- cpr_classify_endem(acacia_rand_res)\n```\n:::\n\n\nLet's have a look at some of the output.\n\n[`cpr_rand_test()`](https://docs.ropensci.org/canaper/reference/cpr_rand_test.html) returns a bunch (54 to be exact!) of metrics about each site in the community matrix, including PE:\n\n\n::: {.cell hash='index_cache/html/acacia-rand-res_f6cbbb8617dd5d291b0fa1aacd7cb65d'}\n\n```{.r .cell-code}\nacacia_rand_res\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3,037 × 55\n   site    pd_obs pd_rand_mean pd_rand_sd pd_obs_z pd_obs_c_upper pd_obs_c_lower\n   <chr>    <dbl>        <dbl>      <dbl>    <dbl>          <dbl>          <dbl>\n 1 -1025… 0.0145        0.0227    0.00506  -1.62                1             98\n 2 -1025… 0.0382        0.0497    0.00745  -1.54                8             91\n 3 -1025… 0.0378        0.0369    0.00635   0.138              55             44\n 4 -1025… 0.0570        0.0613    0.00829  -0.517              33             66\n 5 -1025… 0.0409        0.0419    0.00614  -0.172              41             58\n 6 -1025… 0.00998       0.0101    0.00193  -0.0429             49             48\n 7 -1025… 0.0187        0.0225    0.00393  -0.958              19             80\n 8 -1025… 0.0434        0.0536    0.00902  -1.14               15             84\n 9 -1025… 0.0111        0.0101    0.00197   0.495              81             18\n10 -1025… 0.0903        0.0876    0.0112    0.240              61             38\n# ℹ 3,027 more rows\n# ℹ 48 more variables: pd_obs_q <dbl>, pd_obs_p_upper <dbl>,\n#   pd_obs_p_lower <dbl>, pd_alt_obs <dbl>, pd_alt_rand_mean <dbl>,\n#   pd_alt_rand_sd <dbl>, pd_alt_obs_z <dbl>, pd_alt_obs_c_upper <dbl>,\n#   pd_alt_obs_c_lower <dbl>, pd_alt_obs_q <dbl>, pd_alt_obs_p_upper <dbl>,\n#   pd_alt_obs_p_lower <dbl>, rpd_obs <dbl>, rpd_rand_mean <dbl>,\n#   rpd_rand_sd <dbl>, rpd_obs_z <dbl>, rpd_obs_c_upper <dbl>, …\n```\n:::\n:::\n\n\n[`cpr_classify_endem()`](https://docs.ropensci.org/canaper/reference/cpr_classify_endem.html) appends another column, `endem_type`, that describes the various endemism types.\nLet's count how many of each type was observed:\n\n\n::: {.cell hash='index_cache/html/acacia-endem-res_637798e095d3ffa67c6dfc4ffafff5e0'}\n\n```{.r .cell-code}\ncount(acacia_canape, endem_type)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 2\n  endem_type          n\n  <chr>           <int>\n1 mixed             176\n2 neo                 5\n3 not significant  2827\n4 paleo              12\n5 super              17\n```\n:::\n:::\n\n\nThis is what a map of those various endemism types looks like:\n\n\n::: {.cell hash='index_cache/html/acacia-plot_766347631f03b2c243cbc148ab496739'}\n\n```{.r .cell-code  code-fold=\"true\"}\n# Fist do some data wrangling to make the results easier to plot\n# (add lat/long columns)\nacacia_canape <- acacia_canape |>\n  separate(site, c(\"long\", \"lat\"), sep = \":\") |>\n  mutate(across(c(long, lat), parse_number))\n\n# Tweak the plot theme\ntheme_update(\n  panel.background = element_rect(fill = \"white\", color = \"white\"),\n  panel.grid.major = element_line(color = \"grey60\"),\n  panel.grid.minor = element_blank()\n  )\n\nggplot(acacia_canape, aes(x = long, y = lat, fill = endem_type)) +\n  geom_tile() +\n  # cpr_endem_cols_4 is a CVD-friendly color palette in canaper\n  scale_fill_manual(values = cpr_endem_cols_4) +\n  coord_fixed() +\n  guides(\n    fill = guide_legend(title.position = \"top\", label.position = \"bottom\")\n  ) +\n  theme(legend.position = \"bottom\", legend.title = element_blank())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/acacia-plot-1.png){width=672}\n:::\n:::\n\n\n## rOpenSci\n\nAnother first for me was submitting my package to [rOpenSci](https://ropensci.org/), an organization that [promotes and supports research software written with R](https://ropensci.org/about/).\n**I can't recommend rOpenSci highly enough** for anyone interested in publishing their own R package for research.\n\nFirst, rOpenSci provides [extensive documentation](https://devguide.ropensci.org/) for authoring scientific R packages as well as [automated checks](https://docs.ropensci.org/pkgcheck/).\nJust going through this process alone significantly improved my code.\n\nSecond, packages submitted to rOpenSci undergo thorough and open [code review](https://devguide.ropensci.org/softwarereviewintro.html), which lead me to [several improvements](https://github.com/ropensci/software-review/issues/475) I would have otherwise never thought of^[Thanks to reviewers [Klaus Schliep](https://github.com/KlausVigo) and [Luis Osorio](https://github.com/luismurao), and editor [Toby Hocking](https://github.com/tdhock)].\n\nFinally, the [rOpenSci community](https://ropensci.org/community/) is highly active and welcoming, with [community calls](https://ropensci.org/commcalls/), [co-working sessions](https://ropensci.org/events/), and a lively Slack workspace.\n\nSo please check it out, and a big **thank-you** to rOpenSci!\n\n## More information\n\nFor more information about `canaper`, please see the [GitHub repo](https://github.com/ropensci/canaper), [package website](https://docs.ropensci.org/canaper/), and [preprint](https://doi.org/10.1101/2022.10.06.511072).\n\n## References\n\n::: {#refs}\n:::\n\n## Reproducibility {.appendix}\n\n- [Source code](https://github.com/joelnitta/joelnitta-home/tree/main/posts/2022-10-07_canaper/index.qmd)\n- [`renv` lockfile](https://github.com/joelnitta/joelnitta-home/tree/main/posts/2022-10-07_canaper/renv.lock)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}